Feature: Data Quality Check on d_product Table

  Background:
    Given a table "d_product" in the schema "purgo_playground"
    And the primary key for the table is "prod_id"
    And the columns of interest are "item_nbr", "sellable_qty", and "prod_exp_dt"

  Scenario Outline: Validate 'item_nbr' is not null
    Given the table "d_product" is accessible
    When querying the records where "item_nbr" is null
    Then the count of such records should be retrieved
    And 5 sample records should be displayed

  Scenario Outline: Validate 'sellable_qty' is not null
    Given the table "d_product" is accessible
    When querying the records where "sellable_qty" is null
    Then the count of such records should be retrieved
    And 5 sample records should be displayed

  Scenario Outline: Validate 'prod_exp_dt' format is YYYYMMDD
    Given the table "d_product" is accessible
    When querying the records where "prod_exp_dt" does not match the format YYYYMMDD
    Then the count of such records should be retrieved
    And 5 sample records should be displayed

  Examples: Data Quality Checks
    | Test Condition                          | SQL Query Example                                                  |
    | "item_nbr" is null                      | SELECT COUNT(*) FROM purgo_playground.d_product WHERE item_nbr IS NULL; |
    | Display 5 records where "item_nbr" is null | SELECT * FROM purgo_playground.d_product WHERE item_nbr IS NULL LIMIT 5; |
    | "sellable_qty" is null                  | SELECT COUNT(*) FROM purgo_playground.d_product WHERE sellable_qty IS NULL; |
    | Display 5 records where "sellable_qty" is null | SELECT * FROM purgo_playground.d_product WHERE sellable_qty IS NULL LIMIT 5; |
    | "prod_exp_dt" does not match YYYYMMDD   | SELECT COUNT(*) FROM purgo_playground.d_product WHERE LENGTH(prod_exp_dt) != 8; |
    | Display 5 records with invalid "prod_exp_dt" | SELECT * FROM purgo_playground.d_product WHERE LENGTH(prod_exp_dt) != 8 LIMIT 5; |

  Scenario: Error Condition Handling
    Given the SQL queries are executed in a compliant system
    When an error occurs due to an invalid column name
    Then an error message "Invalid column name in query" should be presented

  Scenario: Error Condition for Connection Issue
    Given the connectivity to the database is established
    When the connection fails during query execution
    Then an error message "Database connection error" should be presented


This specification outlines the feature of performing data quality checks on the `d_product` table. It includes scenarios for validating null checks on critical columns and ensuring date format correctness, as well as error handling scenarios.